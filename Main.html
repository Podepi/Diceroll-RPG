<!DOCTYPE>
<html>
<head>
<style>
.pixel{width:64px; height:64px; background-repeat:no-repeat;}
.inv_icon{width:16px; height:16px; background-repeat:no-repeat; background-image:url(icon_list_16.png); float:left; margin-right:2px; margin-top:2px}
div.itemdiv{text-align:center; border-style:solid; border-color:#000; border-width:1px; width:49%; float:left}
div.itemdiv_i{height:447px; text-align:left; border-style:solid; border-color:#000; border-width:1px; width:49.75%; float:left; overflow:Scroll}
div {height:500px}
div.btndiv {text-align:center; margin: 0 auto; width:64px; height:88px;
  border-style:solid; border-color:#000; border-width:1px;
  cursor:pointer; font-family:Tahoma, Calibri, sans-serif; font-size:11px}
ul {list-style-type: none}
p, li {font-family:Tahoma, Calibri, sans-serif; margin-left:5px}
li.inv {cursor:default}
h2 {font-family:Tahoma, Calibri, sans-serif; text-align:center; font-style:italic; color:#AAA; font-size:15px}

</style>
<script src="jquery-2.1.1.min.js"></script>
<script>
    //images (64x64)
    var img_artifacts = "iconlist_artifacts.png";
    var img_magic = "iconlist_magic.png";
    var img_physical = "iconlist_physical.png";
    var img_ui = "iconlist_ui.png";
    //icons (16x16)
    var ico_list = "icon_list_16.png";
    //Arrays
    var deathmessage = ["The generic enemy attacks and you fail to block. This causes your hitpoints to drop below 0 and you die.",
	"Your armour fails to relect the weapon aimed at your face.",
	"Your armour is less effective than the enemy's weapon.",
	"Blocking that attack is basic knowledge at the Warrior Training School..."];
    var inventory = [];
    //Game variables
    var playerhp;
    var enemyhp;
    var pdamage;
    var edamage;
    var score = 0;
    var highscore = 0;
    //Stats
    var stat_attack = 0;
    var stat_maxhp = 20;
    var stat_gold = 10;
    var stat_defense = 0;
    var hpot = 5;
    var wep_e;
    var armour_e;
    
    function init()
    {
        inventory.pop();
        $(".btndiv").hover(
          function() {
            $(this).css("border-color", "#00CCCC");
          }, function() {
            $(this).css("border-color", "#000");
          }
        );
        $("#fightbuttonimg").css({"background-position":"0px 0px", "background-image":"url(" + img_physical + ")"});
        $("#runbuttonimg").css({"background-position":"0px 0px", "background-image":"url(" + img_ui + ")"});
        battle();
        createitem(-16, 0, "Weapon", "Iron dagger", "A short iron blade with a small hilt", 12, 3);
        createitem(0, -48, "Armour", "Leather armour", "A leather armour set which protects from light damage", 20, 0, 2);
        createitem(0, -64, "Consumable", "Health potion", "A glass bottle containing some sort of red healing liquid", 18, 0, 0, 20);
        createitem(-16, -64,"Consumable", "Health vial", "A glass vial containing some sort of red healing liquid", 9, 0, 0, 10);
        viewstats();
    }

    function battle()
    {
        //if (playerhp <= 0) {
        //    if(score > highscore) {
        //      highscore = score;
        //    }
        //  score = 0;
        //}
        playerhp = stat_maxhp;
        enemyhp = 20;
        $("#info").html("You have ventured into a dungeon!<br>Suddenly, a generic monster jumps out of nowhere and challenges you to a fight.");
        if(score > 0) {
            $("#info").html("The next generic monster rushes forward, eager to battle.");
        }
        $("#readout").html("Your health: " + playerhp + "<br>Enemy health: " + enemyhp);
    }
    function roll()
    {
      if (playerhp <= 0 || enemyhp <= 0) {
          update();
          battle();
      } else {
          pdamage = Math.floor(Math.random() * stat_attack);
          edamage = Math.floor(Math.random() * 5);
          playerhp -= edamage - stat_defense;
          enemyhp -= pdamage;
          update();
      }
    }
    function escape()
    {
        
    }
    function update()
    {
        $("#info").html("You hit the enemy for " + pdamage + " damage.<br>You were hit for " + edamage + " damage.");
        if (playerhp <= 0) {
            playerhp = 0;
            if (enemyhp <= 0) {
                enemyhp = 0;
            }
            $("#info").html(deathmessage[Math.floor(Math.random() * deathmessage.length)]);
            $("#fightbutton").html("Retry");
        } else { if (enemyhp <= 0) {
            if (playerhp <= 0) {
                playerhp = 0;
            }
            enemyhp = 0;
            score++;
            $("#info").html("You have won!");
            $("#fightbutton").html("Venture forth!");
        }}
        $("#readout").html("Your health: " + playerhp + "<br>Enemy health: " + enemyhp);
    }
    function updateitems()
    {
        var iconx;
        var icony;
        iconx = inventory[0].listx;
        icony = inventory[0].listy;
        var t = "<li id='0' class='inv'> <div class='inv_icon' style='background-position:"+iconx+"px "+icony+"px'></div>"+inventory[0].name;
        if(wep_e === inventory[0] || armour_e === inventory[0]) {
           t += "<i> - Equipped</i>";
        }
        t += "</li>"
        for(a = 1; a < inventory.length; a++) {
          iconx = inventory[a].listx;
          icony = inventory[a].listy;
          t += "<li id='"+a+"' class='inv'> <div class='inv_icon' style='background-position:"+iconx+"px "+icony+"px'></div>"+inventory[a].name;
          if(wep_e === inventory[a] || armour_e === inventory[a]) {
            t += "<i> - Equipped</i>";
          }
          t += "</li>"
        }
        $("#inv_list").html(t);
        
        //Mouseover stats
        $("li.inv").hover(
          function() {
            $(this).css("background-color", "#DDD");
            var item = inventory[this.id];
            viewitem(item.type, item.desc, item.gold, item.defense, item.damage, item.heal);
          }, function() {
            $(this).css("background-color", "#FFF");
            viewstats();
          }
        );
        $("li.inv").click(
          function() {
            var item = inventory[this.id];
            var info = $("#this.id").html();
            switch(item.type) {
              case "Weapon":
                if(wep_e === item) {
                  wep_e = "none";
                } else {
                  wep_e = item;
                }
                break;
              case "Armour":
                if(armour_e === item) {
                  armour_e = "none";
                } else {
                  armour_e = item;
                }
                break;
              case "Consumable":
                playerhp += item.heal;
                $("#readout").html("Player: " + playerhp + "<br>Enemy: " + enemyhp);
                $("#info").html("You healed for "+item.heal+" health.");
                inventory.splice(this.id, 1);
                break;
            }
            updateitems();
          }
        );
    }
    function createitem(x, y, t, n, d, g, dmg, def, heal)
    {
        var newitem = new Object();
        
        //Essential values
        newitem.listx = x;
        newitem.listy = y;
        newitem.type = t;
        newitem.name = n;
        newitem.desc = d;
        newitem.gold = g;
        
        //Non-essential values
        if(def != 0) {
          newitem.defense = def;
        } if(dmg != 0) {
          newitem.damage = dmg;
        } if(heal != 0) {
          newitem.heal = heal;
        }
        inventory.push(newitem);
        updateitems();
    }
    function viewitem(type, desc, gold, def, dmg, heal)
    {
        var list_text;
        $("#item_desc").text(desc);
        list_text = "<li><b>"+type+"</b></li><li><br><div class='inv_icon' style='background-position:0px 0x'></div>: "+gold+" gold</li>";
        if(dmg != undefined) {
          list_text += "<li><div class='inv_icon' style='background-position:-16px 0px'></div>: "+dmg+" damage</li>";
        } if(def != undefined) {
          list_text += "<li><div class='inv_icon' style='background-position:-32px 0px'></div>: "+def+" armour</li>";
        } if(heal != undefined) {
          list_text += "<li><div class='inv_icon' style='background-position:-48px 0px'></div>: "+heal+" HP restored</li>";
        }
        $("#item_list").html(list_text);
    }   
    function viewstats()
    {
        if(wep_e.damage == undefined) {
          stat_attack = wep_e.damage;
        } else {stat_attack = 0;}
        if(armour_e.defense != undefined) {
          stat_defense = armour_e.defense;
        } else {stat_defense = 0;}
        $("#item_desc").html("Your stats:");
        $("#item_list").html("<li><div class='inv_icon' style='background-position:-48px 0px'></div>: "+stat_maxhp+
        " max health<li><div class='inv_icon' style='background-position:0px 0px'></div>: "+stat_gold+
        " gold</li><li><div class='inv_icon' style='background-position:-16px 0px'></div>: "+stat_attack+
        " damage</li><li><div class='inv_icon' style='background-position:-32px 0px'></div>: "+stat_defense+
        " armour</li>");
    }
</script>
  <body  onload="init()">
      <div style="text-align:center; border-style:solid; border-width:1px; border-color:#000; width:50%; float:left">
          <p id="info">You have ventured into a dungeon!<br>Suddenly, a generic monster jumps out of nowhere and challenges you to a fight.<br></p>
          <table style="margin:0 auto;"><tr>
            <td><div class="btndiv" id="fightbutton" onclick="roll()"><div id="fightbuttonimg" class="pixel"></div>Fight</div>
            <td><div class="btndiv" id="runbutton" onclick="escape()"><div id="runbuttonimg" class="pixel"></div>Run away</div>
            
          </tr></table>
          <p id="readout">Your health: 20<br> Enemy health: 20</p>
      </div>
    <div class="itemdiv"><p>Items and stats</p>
      <div class="itemdiv_i">
        <p style="text-align:left">Inventory <i>(Click to use)</i> </p>
        <ul id="inv_list">
        </ul>
      </div>
      <div class="itemdiv_i">
        <p id="item_desc">javascript error</p>
        <ul id="item_list"></ul>
      </div>
    </div>
    </body>
</head>
</html>
