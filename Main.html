<!DOCTYPE>
<html>
<head>
<style>
.btn_icon{width:64px; height:64px; background-repeat:no-repeat; background-image:url(default_64.png)}
.menu_icon{width:100px; display:inline-block; border:1px solid #000; cursor:pointer}
.inv_icon{width:16px; height:16px; background-repeat:no-repeat; background-image:url(icon_list_16.png); float:left; margin-right:2px; margin-top:2px}
.no_margin {margin:0}
.no_margin_left {margin-left: 0;}
div {height:500px}
div.menudiv{text-align:center; border-style:solid; border-color:#000; border-width:1px; width:49%; float:left}
div.menudiv_i{height:427px; text-align:left; border-top:1px solid #000; overflow-y:auto}
div.btndiv {text-align:center; margin: 0 auto; width:64px; height:88px;
  border-style:solid; border-color:#000; border-width:1px;
  cursor:pointer; font-family:Tahoma, Calibri, sans-serif; font-size:11px
}
div.btndiv:hover {border-color:#00CCCC}
ul {list-style-type: none;
  -webkit-touch-callout: none;
  -webkit-user-select: none;
  -khtml-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;}
ul.menubar {
  width:90%;
  display: block;
  height:15px;
}
p, li {font-family:Tahoma, Calibri, sans-serif; margin-left:5px}
p.menuheading {display:inline-block; margin:auto; padding-bottom: 5px; height:20px}
li.inv{cursor:pointer}
li.sort{cursor:pointer; text-align:left; display:inline-block;}
li.shop{cursor:pointer; text-align:left; margin-left: 0}

/* CSS Effects */

.float {
  display: inline-block;
  -webkit-transition-duration: 0.3s;
  transition-duration: 0.3s;
  -webkit-transition-property: transform;
  transition-property: transform;
  -webkit-transform: translateZ(0);
  transform: translateZ(0);
  box-shadow: 0 0 1px rgba(0, 0, 0, 0);
}
.float:hover, .float:focus, .float:active {
  -webkit-transform: translateY(5px);
  transform: translateY(5px);
}
.glow {
  display: inline-block;
  -webkit-transition-duration: 0.1s;
  transition-duration: 0.1s;
  -webkit-transition-property: box-shadow;
  transition-property: box-shadow;
  -webkit-transform: translateZ(0);
  transform: translateZ(0);
  box-shadow: 0 0 1px rgba(0, 0, 0, 0);
}
.glow:hover, .glow:focus, .glow:active {
  box-shadow: 0 0 8px rgba(0, 0, 0, 0.6);
}

</style>
<script src="jquery-2.1.1.min.js"></script>
<script>
    //images (64x64)
    var img_artifacts = "iconlist_artifacts.png"; // 64x64 misc. object  spritesheet
    var img_magic = "iconlist_magic.png"; // 64x64 magic spritesheet
    var img_physical = "iconlist_physical.png"; //64x64 physical attack spritesheet
    var img_ui = "iconlist_ui.png"; //64x64 ui spritesheet
    var img_def64 = "default_64.png"; //default 64x64 image
    //icons (16x16)
    var ico_list = "icon_list_16.png"; //16x16 icon spritesheet
    //Arrays
    var deathmessage = /* This array contains all the phrases which show up when you die */
    ["The generic enemy attacks and you fail to block, causing your hitpoints to drop below 0. You die.",
	"Your armour fails to relect the weapon aimed at your face.",
	"Your armour is less effective than the enemy's weapon.",
	"Blocking that attack is basic knowledge at the Warrior Training School...",
    "You are sent to The Place Where All Beings Are Eternally Blessed."];
    var inventory = []; // This array contains the items the inventory has - all array work is done in the createItem() function
    var shoplist = []; // This array contains the items the shop has - all array work is done in the shop functions 
    var enemy_list = /* This array contains all the different enemies you can can face - purely cosmetic at the moment - NOTE: Should change resistances and max health of each type in the near future */
    ["orc", "bandit", "golem", "spider", "bat", "wraith", "ghost", "troll", "ogre"];
    var adjective_list = /* This array contains all the adjectives an enemy can have - purely cosmetic */
    ["smelly", "nasty", "terrible", "ugly", "mean", "frightening", "fearsome", "egotistical", "badly-disguised", "annoying", "loud", "armed", "armoured", "stereotyped", "ghostly", "orcish", "wraith-like", "trollish", "spidery", "golem-like"]
    var shopkeeper = /* This array contains all the various phrases and actions the shopkeeper does */
    ["tells you about all the various bargains.", 
    "complains about shoplifters.",
    "tells tales of mysterious dungeons and treasures.",
    "tells of strange and powerful artifacts."];
	
    //Game variables
    var playerhp; // Amount of health you have at the present
    var enemyhp; // Amount of health enemy has - dealt with during battle - eventBattle() function
    var pdamage; // Amount of damage you deal - dealt with at runtime in the roll() function
    var edamage; // Amount of damage enemy deals - dealt with at runtime in the roll() function
    var score = 0; // Number of enemies defeated this run for previously in-place score system
    var highscore = 0; // High score for previously in-place score system
    var menuscreen = "inventory"; // For planned menu screens e.g. travel screen for selecting destinations, inventory screen for managing items, stats screen for managing stats
    var battle = false; //Boolean defines whether hp potions display enemy health on readout
	
	//Stats
    var stat_maxhp = 20; // Maximum amount of hitpoints player has
    var stat_gold = 10; // Amount of gold player has
    var stat_attack = 0; // Damage dealt by player on physical attack
    var stat_defense = 0; // Reduces damage taken by player from harm; 25% effective against magic
    var stat_magicdef = 0; // Reduces damage taken by player from magic
    var stat_magicatk = 0; // Damage dealt with magic by player
    var weapon_e; // Equipped weapon
    var armour_e; // Equipped armour
    var amulet_e; // Equipped amulet
    
    function init()
    {
        $("#menubar").html('<li id="menubar_inv" class="menu_icon no_margin_left glow">Inventory</li>' + 
                           '<li id="menubar_qst" class="menu_icon no_margin_left glow">Errands</li>');
        $("#menubar_inv").on("click", function() {
            viewMenu("inventory");
        });
        $("#menubar_qst").on("click", function() {
            viewMenu("quests");
        });
		$("#list_sort").html('<li id="sort_weapon" class="sort">W</li>' +
							 '<li id="sort_armour" class="sort">A</li>');
		$("li.sort").hover(
          function() {
            $(this).css("background-color", "#DDD");
          }, function() {
            $(this).css("background-color", "#FFF");
          }
        );
        playerhp = stat_maxhp;
        inventory.pop();
        shoplist.pop();
        init_shop();
        event_town();
        createItem("inv", -16, 0, "Weapon", "Iron dagger", "A short iron blade with a small hilt", 12, 3);
        createItem("inv", 0, -48, "Armour", "Leather armour", "A leather armour set which protects from light damage", 20, 0, 1);
        createItem("inv", 0, -64, "Consumable", "Health potion", "A glass bottle containing some sort of red healing liquid", 18, 0, 0, 20);
        createItem("inv", -16, -64,"Consumable", "Health vial", "A glass vial containing some sort of red healing liquid", 9, 0, 0, 10);
        viewStats();
    }
    function event_explore_start() {
        window.setTimeout("event_explore_end()", 1000);
        $("#info").html("Exploring...");
        var btn1 = $("#eventbutton01");
        var btn2 = $("#eventbutton02");
        var btn3 = $("#eventbutton03");
        btn1.hide();
        btn2.hide();
        btn3.hide();
    }
    function event_explore_end() {
        var btn1 = $("#eventbutton01");
        var btn2 = $("#eventbutton02");
        var btn3 = $("#eventbutton03");
        var info = $("#info");
        var rand = Math.floor(Math.random() * 2);
        switch(rand) {
			case 0:
				$("#info").html("You found a penny!");
				stat_gold += 1;
				btn1.show();
				btn1.html('<div class="btn_icon"></div>Return to Town');
				btn1.off('click').on("click", function() {
					event_town();
				});
				btn2.show();
				btn2.html("<div class='btn_icon' style='background-position:-128px, 0px; background-image:url("+img_ui+")'></div>Onward!");
				viewStats();
				break;
            case 1:
                $("#info").html("All of a sudden "+ desc() + " jumps out of nowhere!");
                btn1.show();
				btn2.show();
                event_battle("nodesc");
                break;
            case 2:
                $("#info").html("You walk for hours but find nothing");
				btn1.show();
				btn1.html('<div class="btn_icon"></div>Return to Town');
				btn2.show();
				btn2.html("<div class='btn_icon' style='background-position:-128px, 0px; background-image:url("+img_ui+")'></div>Onward!");
                break;
            case 3:
				
                break;
            case 4:
				
                break;
        }
    }
    function event_town()
    {
        event_shop("hide");
        var btn1 = $("#eventbutton01");
        var btn2 = $("#eventbutton02");
        var btn3 = $("#eventbutton03");
		btn1.show();
        btn1.html('<div class="btn_icon"></div>Shop');
        btn1.off('click').on("click", function() {
            event_shop("show");
        });
        btn2.show();
        btn2.html("<div class='btn_icon' style='background-position:-128px, 0px; background-image:url("+img_ui+")'></div>Explore");
        btn2.off('click').on("click", function() {
            event_explore_start();
        });
        btn3.hide();
        $("#readout").html("Your health: " + playerhp);
        $("#info").html("Welcome to the Town");
    }
    function init_shop()
    {
        createItem("shop", -16, 0, "Weapon", "Iron dagger", "A short iron blade with a small hilt", 12, 3);
        createItem("shop", -16, 0, "Weapon", "Steel dagger", "A short steel blade with a small hilt", 20, 5);
        createItem("shop", 0, -48, "Armour", "Leather armour", "A leather armour set which protects from light damage", 20, 0, 2);
		createItem("shop", 0, -64, "Armour", "Iron armour", "An iron armour set which protects from moderate damage", 20, 0, 5);
        createItem("shop", 0, -64, "Consumable", "Health potion", "A glass bottle containing some sort of red healing liquid", 18, 0, 0, 20);
        createItem("shop", -16, -64,"Consumable", "Health vial", "A glass vial containing some sort of red healing liquid", 9, 0, 0, 10);
        createItem("shop", -16, -80, "Amulet", "Amulet of enhancement", "An amulet with magical powers", 122, 15, 5);
        
        updateShop();
    }
    function updateShop()
    {
        var iconx;
        var icony;
        iconx = shoplist[0].listx;
        icony = shoplist[0].listy;
        var t = "<li id='0' class='shop'> <div class='inv_icon' style='background-position:"+iconx+"px "+icony+"px'></div>"+shoplist[0].name;
		if(stat_gold < shoplist[0].gold) {
			t += "<i style='color:#FF0000'> - Not enough gold</i>";
        }
        t += "</li>"
        for(a = 1; a < shoplist.length; a++) {
          iconx = shoplist[a].listx;
          icony = shoplist[a].listy;
          t += "<li id='"+a+"' class='shop'> <div class='inv_icon' style='background-position:"+iconx+"px "+icony+"px'></div>"+shoplist[a].name;
          if(stat_gold < shoplist[a].gold) {
            t += "<i style='color:#FF0000'> - Not enough gold</i>";
          }
          t += "</li>"
        }
        $("#shop_list").html(t);
		$("#shop_heading").html("Shop<br><div class='inv_icon' style='float:none; background-position:0px 0px; display:inline-block;'></div>: " + stat_gold);
		$("li.shop").hover(
			function() {
				$(this).css("background-color", "#DDD");
				var item = shoplist[this.id];
				viewItem(item);
			}, function() {
				$(this).css("background-color", "#FFF");
				viewStats();
			}
		);
		$("li.shop").off("click").on("click",
		function() {
			var item = shoplist[this.id];
			//var info = $("#this.id").html();
			if(stat_gold >= item.gold) {
				inventory.push(item);
				stat_gold -= item.gold;
				updateItems();
				$("#shop_list").html(updateShop());
			}
		});
    }
    function event_shop(visible)
    {
        switch(visible) {
            case "show":
				updateShop()
                var btn1 = $("#eventbutton01");
                var btn2 = $("#eventbutton02");
                var btn3 = $("#eventbutton03");
                $("#shop").show();
                btn1.html('<div class="btn_icon"></div>Exit to Town');
                btn1.off('click').on("click", function(){
                    event_town();
                });
                btn2.hide();
                btn3.hide();
                $("#info").html('The shopkeeper ' + shopkeeper[Math.floor(Math.random() * shopkeeper.length)]);
				
                break;
            case "hide":
                $("#shop").hide();
                break;
        }
    }
    function event_battle(t)
    {
        /*if (playerhp <= 0) {
            if(score > highscore) {
              highscore = score;
            }
          score = 0;
          }
        */
        var btn1 = $("#eventbutton01");
        var btn2 = $("#eventbutton02");
        var btn3 = $("#eventbutton03");
        btn1.off('click').on('click', function() {
            roll();
        });
        btn1.html('<div class="btn_icon" style="background-position:0px 0px; background-image:url('+img_physical+')"></div>Fight');
        btn2.show();
        btn2.off('click').on('click', function() {
            event_town();
        });
        btn2.html('<div class="btn_icon" style="background-position:0px 0px; background-image:url('+img_def64+')"></div>Town');
        btn3.hide();
        playerhp = stat_maxhp;
        enemyhp = 20;
		battle = true;
        if (t != "nodesc") {
            $("#info").html("You have ventured into a dungeon!<br>Suddenly, "+ desc() + " jumps out of nowhere and challenges you to a fight.");
        }
        $("#readout").html("Your health: " + playerhp + "<br>Enemy health: " + enemyhp);
    }
	function updateFight()
    {
        $("#info").html("You hit the enemy for " + pdamage + " damage.<br>You were hit for " + edamage + " damage.");
        if (playerhp <= 0) {
            playerhp = 0;
            if (enemyhp <= 0) {
                enemyhp = 0;
            }
            $("#info").html(deathmessage[Math.floor(Math.random() * deathmessage.length)]);
            $("#eventbutton01").hide();
            $("#eventbutton02").show();
        } else { if (enemyhp <= 0) {
            if (playerhp <= 0) {
                playerhp = 0;
            }
            enemyhp = 0;
			var gold_inc = Math.ceil(Math.random()*10);
			stat_gold += gold_inc;
			battle = false;
            //score++;
            $("#info").html("You have won!<br>You gained " + gold_inc + " gold!");
            $("#eventbutton01").hide();
            $("#eventbutton02").show();
        }}
        $("#readout").html("Your health: " + playerhp + "<br>Enemy health: " + enemyhp);
    }
    function event_escape()
    {
        var escapechance = Math.random();
        if(escapechance >= 0.2) {
            $("#info").html("You have successfully escaped!");
            var btn1 = $("#eventbutton01");
            var btn2 = $("#eventbutton02");
            var btn3 = $("#eventbutton03");
            btn1.off('click').on('click', function() {
                event_town();
            });
            btn2.hide();
            btn3.hide();
        } else {
            $("#info").html("You are unable to turn and run!");
        }
    }
    function desc()
    {
        var enemy = enemy_list[Math.floor(Math.random() * enemy_list.length)];
        var adjective = adjective_list[Math.floor(Math.random() * adjective_list.length)];
        var vowel = /[aeiou]/i;
        var aa = "a ";
        if(adjective.search(vowel) == 0) {aa="an ";}
        return(aa + adjective + " " + enemy);
    }
    function roll()
    {
      if (playerhp <= 0 || enemyhp <= 0) {
          updateFight();
          event_battle();
      } else {
          pdamage = Math.floor(Math.random() * stat_attack);
          edamage = Math.floor(Math.random() * 5);
          playerhp -= edamage - stat_defense;
          enemyhp -= pdamage;
          updateFight();
      }
    }
    function updateItems()
    {
        var iconx;
        var icony;
        try {
        iconx = inventory[0].listx;
        icony = inventory[0].listy;
        } catch(err){return("itemupdate failed")};
        var t = "<li id='0' class='inv'> <div class='inv_icon' style='background-position:"+iconx+"px "+icony+"px'></div>"+inventory[0].name;
        if(weapon_e === inventory[0] || armour_e === inventory[0]) {
           t += "<i> - Equipped</i>";
        }
        t += "</li>"
        for(a = 1; a < inventory.length; a++) {
          iconx = inventory[a].listx;
          icony = inventory[a].listy;
          t += "<li id='"+a+"' class='inv'> <div class='inv_icon' style='background-position:"+iconx+"px "+icony+"px'></div>"+inventory[a].name;
          if(weapon_e === inventory[a] || armour_e === inventory[a] || amulet_e === inventory[a]) {
            t += "<i> - Equipped</i>";
          }
          t += "</li>"
        }
        $("#menu_list_left").html(t);
        
        //Mouseover stats
        $("li.inv").hover(
          function() {
            $(this).css("background-color", "#DDD");
            var item = inventory[this.id];
            viewItem(item);
          }, function() {
            $(this).css("background-color", "#FFF");
            viewStats();
          }
        );
        $("li.inv").off("click").on( "click",
          function() {
            var item = inventory[this.id];
            var info = $("#this.id").html();
            switch(item.type) {
              case "Weapon":
                if(weapon_e === item) {
                  weapon_e = "none";
                } else {
                  weapon_e = item;
                }
                break;
              case "Armour":
                if(armour_e === item) {
                  armour_e = "none";
                } else {
                  armour_e = item;
                }
                break;
              case "Consumable":
                playerhp += item.heal;
				var hpText = "Your health: " + playerhp;
				if (battle == true) {
					 hpText += "<br>Enemy health: " + enemyhp;
				}
                $("#readout").html(hpText);
                $("#info").html("You were healed for "+item.heal+" health.");
                inventory.splice(this.id, 1);
                break;
              case "Amulet":
                if(amulet_e === item) {
                  amulet_e = "none";
                } else {
                  amulet_e = item;
                }
                break;
            }
            if (menuscreen == "inventory") {
                updateItems();
            }
          }
        );
    }
    function createItem(a, x, y, t, n, d, g, dmg, def, h)
    {
        var newitem = new Object();
        
        //Essential values
        newitem.listx = x;
        newitem.listy = y;
        newitem.type = t;
        newitem.name = n;
        newitem.desc = d;
        newitem.gold = g;
        
        //Non-essential values
        if(def != 0) {
          newitem.defense = def;
        } if(dmg != 0) {
          newitem.damage = dmg;
        } if(h != 0) {
          newitem.heal = h;
        }
        switch(a) {
        case "inv":
            inventory.push(newitem);
            break;
        case "shop":
            shoplist.push(newitem);
            break;
        }
        if (menuscreen == "inventory") {
            updateItems();
        }
    }
    function viewItem(item)
    {
        var list_text;
        $("#menu_readout_top").text(item.desc);
        list_text = "<li><b>"+item.type+"</b></li><li><br><div class='inv_icon' style='background-position:0px 0x'></div>: "+item.gold+" gold</li>";
        if(item.damage != undefined) {
          list_text += "<li><div class='inv_icon' style='background-position:-16px 0px'></div>: "+item.damage+" damage</li>";
        } if(item.defense != undefined) {
          list_text += "<li><div class='inv_icon' style='background-position:-32px 0px'></div>: "+item.defense+" armour</li>";
        } if(item.heal != undefined) {
          list_text += "<li><div class='inv_icon' style='background-position:-48px 0px'></div>: "+item.heal+" HP restored</li>";
        }
        $("#menu_list_right").html(list_text);
        $("#menu_extended").hide();
        $("#menu_list_ext").hide();
    }   
    function viewStats()
    {
        try {
          if (weapon_e.damage != undefined) {
            stat_attack = weapon_e.damage;
          } else {throw "undefined value";}
        } catch(err) {stat_attack = 0;}
        try {
            if (armour_e.defense != undefined) {
              stat_defense = armour_e.defense;
            } else {throw "undefined value";}
        } catch(err) {stat_defense = 0;}
        try {
            if (amulet_e.defense != undefined) {
              stat_defense += amulet_e.defense;
            } else {throw "undefined value";}
            if (amulet_e.damage != undefined) {
              stat_attack += amulet_e.damage;
            } else {throw "undefined value";}
        } catch(err) {}
        $("#menu_readout_top").html("Your stats:");
        $("#menu_list_right").html("<li><div class='inv_icon' style='background-position:-48px 0px'></div>: "+stat_maxhp+
        " max health<li><div class='inv_icon' style='background-position:0px 0px'></div>: "+stat_gold+
        " gold</li><li><div class='inv_icon' style='background-position:-16px 0px'></div>: "+stat_attack+
        " damage</li><li><div class='inv_icon' style='background-position:-32px 0px'></div>: "+stat_defense+
        " armour</li><li><div class='inv_icon' style='background-position:-64px 0px'></div>: "+stat_magicdef+
        " magic resistance</li><li><div class='inv_icon' style='background-position:-80px 0px'></div>: "+stat_magicatk+
        " magic damage</li>");
        $("#menu_extended").hide();
        $("#menu_list_ext").hide();
    }
    function viewMenu(screen)
    {
        switch(screen)
        {
            case "inventory":
                viewStats();
                $("#menuheading").html("Items and stats");
                $("#list_heading").html("Inventory <i>(Click to use)</i>");
        }
    }
</script>
  <body  onload="init()">
      <div style="text-align:center; border-style:solid; border-width:1px; border-color:#000; width:50%; float:left">
          <div style="text-align:center; overflow:hidden; height:50%">
          <p id="info" style="margin-left:0">info</p>
          <table style="margin:0 auto;"><tr>
            <td><div class="btndiv float" id="eventbutton01"><div class="btn_icon"></div></div>
            <td><div class="btndiv float" id="eventbutton02"><div class="btn_icon"></div></div>
            <td><div class="btndiv float" id="eventbutton03"><div class="btn_icon"></div></div>
          </tr></table>
          <p id="readout">readout</p>
          </div>
          <div id="shop" style="text-align:center; overflow-y:auto; height:50%; border-top:1px solid #000">
              <p id="shop_heading">Shop</p>
              <ul id="shop_list"></ul>
          </div>
      </div>
    <div class="menudiv">
        <ul id="menubar" class="menubar">
        </ul>
        <p class="menuheading">Items and stats</p>
        <div>
            <div class="menudiv_i" style="width:49.7%; float:left;">
                <p id="list_heading" style="text-align:left">Inventory <i>(Click to use)</i> </p>
				<ul id="list_sort"></ul>
                <ul id="menu_list_left"></ul>
            </div>
            <div class="menudiv_i">
                <p id="menu_readout_top">javascript error</p>
                <ul id="menu_list_right"></ul>
                <p id="menu_extended">extended menu</p>
                <ul id="menu_list_ext"></ul>
            </div>
        </div>
    </div>
    </body>
</head>
</html>
